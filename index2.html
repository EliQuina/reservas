<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="estilo.css">
    <title>Reservas</title>
</head>
<style>
    body {
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.5), rgba(0, 0, 0, 0.5)), url(https://s1.1zoom.me/big0/807/357828-admin.jpg);
        background-size: cover;
        background-position: center;
        color: white;
    }
</style>
<body id="reservas">
    <div class="row">
        <div class="col-md-12">
            
            <br>
            &nbsp; &nbsp; &nbsp; &nbsp;
            <br>
        </div>

    </div>
    <center><h1 class="txt3 ">Gestion de Pacientes</h1></center>
    
    <hr>
    
    
        <form id="form-reservas">
                <div class="row">
                    <div class="col-md-5" style="align-items: center;">
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Id:</b> </label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <input type="text" id="id"  class="alert alert-warning" >
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Nombres y Apellidos: </b></label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <input type="text" id="edad" class="alert alert-warning" >
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
                        <label for=""><b>:Email</b></label>
                        &nbsp;
                        <input type="date" id="fecha_nacimiento" class="alert alert-warning" >
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Telefono:</b> </label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; &nbsp;  &nbsp; 
                        <input type="text" id="nombre" class="alert alert-warning"  >
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <select style="border-radius: 10px;" type="text" id="tipo" name="tipo">
                            <option value="Individual">Pendiente</option>
                            <option value="Conyugal">Confirmada</option>
                            <option value="Familiar">Cancelada</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Precio: </b></label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp;
                        <input type="text" id="color" class="alert alert-warning" >
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Fecha y hora de Entrada </b></label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
                        <input type="text" id="especie" class="alert alert-warning" >
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Fecha y hora de salida:</b> </label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                       <input type="text" id="genero"  class="alert alert-warning">
                        <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <select style="border-radius: 10px; display: flex;" type="text" id="estado" name="estado">
                            <option value="Pendiente">Pendiente</option>
                            <option value="Confirmada">Confirmada</option>
                            <option value="Cancelada">Cancelada</option>
                        </select>
                        <input type="text" id="peso" class="alert alert-warning"                         <br>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        <label for=""><b>Numero de Habitación:</b> </label>
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  &nbsp; &nbsp; 
                        <input type="text" id="raza" class="alert alert-warning" >
                    </div>
                    <div class="col-md-3">
                        <br>
                        <br>
                        <button type="submit" class="btn btn-success" id="btn-submit">Agregar paciente</button>
                        <hr>
                        <center>
                            <input type="text" name="buscar" id="buscar" class="alert alert-warning" placeholder="Ingrese código">
                            <br>
                            <button type="button" id="btn-buscar" class="btn btn-dark">BUSCAR</button>
                            <button type="button" id="btn-limpiar" class="btn btn-info">Limpiar</button> 
                            <hr>
                        </center>
                        
                        <center><button type="button" class="btn btn-warning" id="btn-editar">EDITAR

                        </button> <button type="button" class="btn btn-danger" id="btn-eliminar">ELIMINAR</button>
                    </center>
                        
                    </div>             

                </div>

        </form>  
        ojo
        <!-- Tabla para mostrar los pacientes -->
    <div class="container">
        <center><h2>Lista de Reservas</h2></center>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>Nombres y Apellidos</th>
                    <th>Email</th>
                    <th>Telefonó</th>
                    <th>Tipo</th>
                    <th>Precio</th>
                    <th>Fecha y hora de entrada</th>
                    <th>Fecha y hora de salida</th>
                    <th>Estado de Habitación</th>
                    <th>Numero de Habitación</th>
                </tr>
            </thead>
            <tbody id="tabla-reservas">
                <!-- Los datos de los pacientes se insertarán aquí -->
            </tbody>
        </table>
    </div>
    
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import {getFirestore,collection,addDoc,onSnapshot,updateDoc,deleteDoc,doc,query, where,getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAVMPwYyzfomxTdROK_jYhJ72QBT0cy2zw",
            authDomain: "hotel-2a939.firebaseapp.com",
            projectId: "hotel-2a939",
            storageBucket: "hotel-2a939.appspot.com",
            messagingSenderId: "342922590938",
            appId: "1:342922590938:web:b86f4304821e21f3a983e3"
        };
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        const db = getFirestore(app);

        //FUNCION DE AGREGAR
        const reservas = document.getElementById("form-reservas");
        reservas.addEventListener("submit",async(e)=>{
            e.preventDefault();
            const codigo = reservas.codigo.value;
        
            // Verificar si el código ya existe
            const codigoExistente = await verificarCodigoExistente(codigo);
            if (codigoExistente) {
                alert("El código ya existe. Por favor, ingrese un código único.");
                return;
            }
            await addDoc(collection(db,"reservas"),{
                id: reservas.id.value,
                nombresyapellidos: reservas.nombresyapellidos.value,
                email: reservas.email.value,
                telefono: reservas.telefono.value,
                tipo: reservas.tipo.value,
                precio: reservas.precio.value,
                fecha_hora_en: reservas.fecha_hora_en.value,
                fecha_hora_sal: reservas.fecha_hora_sal.value,
                estado: reservas.estado.value,
                num_ha: reservas.num_ha.value
            });
            reservas.reset();
        });

        
            // Verificar si el código ya existe en la base de datos
            async function verificarCodigoExistente(id) {
                const q = query(collection(db, "reservas"), where("id", "==", id));
                const querySnapshot = await getDocs(q);
                return !querySnapshot.empty;
            }


           // Mostrar pacientes en la tabla
        const tablaReservas = document.getElementById("tabla-reservas");
        onSnapshot(collection(db, "reservas"), (snapshot) => {
            tablaReservas.innerHTML = "";
            snapshot.forEach((doc) => {
                const paciente = doc.data();
                tablaReservas.innerHTML += `
                    <tr>
                        <td>${reservas.id}</td>
                        <td>${reservas.nombresyapellidos}</td>
                        <td>${reservas.email}</td>
                        <td>${reservas.telefono}</td>
                        <td>${reservas.tipo}</td>
                        <td>${reservas.precio}</td>
                        <td>${reservas.fecha_hora_en}</td>
                        <td>${reservas.fecha_hora_sal}</td>
                        <td>${reservas.estado}</td>
                        <td>${reservas.num_ha}</td>
                    </tr>
                `;
            });
        });

        ///FUNCION BUSCAR
        const btnBuscar = document.getElementById("btn-buscar");
        btnBuscar.addEventListener("click", () => {
            const codigo = document.getElementById("buscar").value;
            const tablaReservas = document.getElementById("tabla-reservas");
            const rows = tablaReservas.getElementsByTagName("tr");
            let reservaEncontrado = false;

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName("td");
                const codigoReservas = cells[0].innerText;

                if (codigoReservas === codigo) {
                    document.getElementById("id").value = cells[0].innerText;
                    document.getElementById("nombresyapellidos").value = cells[1].innerText;
                    document.getElementById("email").value = cells[2].innerText;
                    document.getElementById("telefono").value = cells[3].innerText;
                    document.getElementById("tipo").value = cells[4].innerText;
                    document.getElementById("precio").value = cells[5].innerText;
                    document.getElementById("fechayhoraentrada").value = cells[6].innerText;
                    document.getElementById("fechayhorasalida").value = cells[7].innerText;
                    document.getElementById("estado").value = cells[8].innerText;
                    document.getElementById("numero_habitaciones").value = cells[9].innerText;

                    reservaEncontrado = true;
                    break;
                }
            }

            if (!reservaEncontrado) {
                alert("No se encontró ninguna reserva con ese código.");
            }
        });
        
       

         //FUNCION EDITAR
        const editarBtn = document.getElementById("btn-editar");
        editarBtn.addEventListener("click", async () => {
            const codigo = document.getElementById("id").value;
            const q = query(collection(db, "reservas"), where("id", "==", id));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach(async (docSnap) => {
                const docRef = doc(db, "reservas", docSnap.id);
                await updateDoc(docRef, {
                    id: document.getElementById("id").value,
                    nombresyapellidos: document.getElementById("nombresyapellidos").value,
                    email: document.getElementById("email").value,
                    telefono: document.getElementById("telefono").value,
                    tipo: document.getElementById("tipo").value,
                    precio: document.getElementById("precio").value,
                    fecha_hora_en: document.getElementById("fechayhoraentrada").value,
                    fecha_hora_sal: document.getElementById("fechayhorasalida").value,
                    estado: document.getElementById("estado").value,
                    num_ha: document.getElementById("numero_habitaciones").value
                });
                reservas.reset();
            });
        });

            //FUNCION ELIMINAR
        const eliminarBtn = document.getElementById("btn-eliminar");
        eliminarBtn.addEventListener("click", async () => {
            const codigo = document.getElementById("id").value;
            const q = query(collection(db, "reservas"), where("id", "==", id));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach(async (docSnap) => {
                await deleteDoc(doc(db, "reservas", docSnap.id));
            });
            reservas.reset();
        });


         //FUNCION LIMPIAR PANTALLA
         const btnLimpiar = document.getElementById("btn-limpiar");
        btnLimpiar.addEventListener("click", () => {
            document.getElementById("id").value = "";
            document.getElementById("nombresyapellidos").value = "";
            document.getElementById("email").value = "";
            document.getElementById("telefono").value = "";
            document.getElementById("tipo").value = "";
            document.getElementById("precio").value = "";
            document.getElementById("fechayhoraentrada").value = "";
            document.getElementById("fechayhorasalida").value = "";
            document.getElementById("estado").value = "";
            document.getElementById("numero_habitaciones").value = "";
        });

    </script>
</body>
</html>